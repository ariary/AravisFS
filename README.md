
# AravisFS üóªüåÑ

![Panorama sur les Aravis](data:image/jpeg;base64,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)

A fake encrypted file system üîê *Another non-production ready software*

	üåüüåüüåüüåüüåüüåüüåüüåüüåüüåü
**DRAFT STAGE - *Any idea, criticism, contribution is welcome***

No pretension just to learn and keep my mind busy

	üåüüåüüåüüåüüåüüåüüåüüåüüåüüåü
## üî¶ Idea
**Aim?**
Providing a fake encrypted FS and utilities to interact with. 

Our objective is to leak as little information as possible. The local machine is our trusted environnement where we could manipulate the key, the clear-text data. This is our **(light side)**
 And on another untrusted location we have our encrypted fs. We do not want to manipulate key or clear text but we want to be able to interact as much as possible with the encrypted fs. This is our **(dark side)**

For this purposewe use 2 utilities, each on different side:
- `adret`: Encrypt/decrypt fs. Deal with key & clear-text data ***(light side)***
 - `ubac`: Interact with encrypted fs. Deal with no "sensitive" data (no key & clear-text manipulation) ***(dark side)***

*We accept to leak information about the fs structure (number of file/folder, size)*

**Why fake?**
 - Cause encryption isn't strong
 - Cause it does not provide a real fs, just a representation of it. *(And to be honest it only encrypts a folder but by extension we say a file system)*

**Use case?**
 - To avoid your volume being spied on by your cloud provider
 - To make a temporary folder/fs on a target machine if you are a black hat and you do not want to be spied on by forensic people. Or if you want to hide a payload.
 - To boast of having an encrypted fs .. but practically unusable anyway
 
 ## üí∫ Usage (***In case I ever code***)
### üîç Explore encrypted folder
#### List folder content from my encrypted fs
First I encrypt my fs :

    (local) $ adret -encrypt_fs <myfolder> <mykey>

Then I put the result (encrypted fs `.arafs`) and `ubac` utility on the dark zone (target machine, my OVH server, container on GKE, etc) the way I want. I could then remove `<myfolder>`from my host, otherwise it has real no sense

Say I want to `ls` in `<myfolder>/toto/`, so I encrypt the path:

    (local) $ adret -encrypt_path <myfolder>/toto/ <mykey>
    **We obtain darkpath! COPY THE RESULT**

Then we do the `ls` in our encrypted fs:

    (remote) ubac -ls darkpath myencryptedfs.arafs
    **We obtain ls result! COPY THE RESULT**

And finally decrypt the result of ls:

    (local) $ adret -encrypt_path <ls_rult> <mykey>

#### Print file content from my encrypted fs
Idem as above but change the `ubac command with:

    (remote) ubac -cat darkpath myencryptedfs.arafs

### ü§ñ Automatize a bit 
If you want to interact with your remote encrypted fs more fluidly

**Prerequisites**

 - my encrypted fs + `ubac`on remote
 - remote is accesible on port `<ip>:<port>`
 - `adret` on local 


Start your `ubac` listener in the same location where the encrypted fs is:

    (remote) $ ubac -listen <port>

Connect to the listener with your local machine:

    (local) $ adret -connect <ip>:<port>

I can now interact directly with my encrypted fs on my local machine and obtain direct result:

    (remote) $ adret -remotecat /random/topath/file

### ‚úÇÔ∏è Manipulate encrypted fs
#### Remove a file from encrypted fs
    (remote) ubac -rm darkpath myencryptedfs.arafs
 
Use `-mv`, `-touch` etc the same way you could use it in unix system

## üìù Spec
### Target 1 - MVP

#### üåÑ Adret
| function    | parameter | return         | use                                                                 
|-------------|-----------|----------------|---|
| encrypt     | key, data | encrypted_data | Encrypt/Decrypt  `data`  |
| encrypt_fs  | key, path | encrypted_fs   | Encrypt fs (=folder pointed by the `path`)  |
| darken_path | key, path | encrypted_path | Encrypt a `path`                                            |

`encrypted_fs`is a file (`.arafs`) representing the folder hierarchy (~fs) encrypted. ***TO DO*** Determine the structure (tree, yaml etc )

#### üóª Ubac
| function | parameter                   | return               | use                        |
|----------|-----------------------------|----------------------|----------------------------|
| ls       | encrypted_fs, darkened_path | encrypted_result     | Get encrytped `ls` result  |
| cat      | encrypted_fs, darkened_path | encrypt_content_file | Get encrypted `cat` result |

### Target 2 - The future is now
#### üåÑ 
| function | parameter | return | use                                                                  |
|----------|-----------|--------|----------------------------------------------------------------------|
| remotels, remotecat, etc   | host, port, path, key     |        | connt with `ubac`  listener to perform different function on the encrypted fs |

#### üóª
| function | parameter | return | use                                                                  |
|----------|-----------|--------|----------------------------------------------------------------------|
| listen   | port      |        | Act like a server. Wait for request from ubac, process it, return it |

### target 3 - The world is yours
#### üóª
| function | parameter                   | return | use                       |
|----------|-----------------------------|--------|---------------------------|
| mv       | encrypted_fs, darkened_path |        | mv in the encrypted fs    |
| cp       | encrypted_fs, darkened_path |        | cp in the encrypted fs    |
| rm       | encrypted_fs, darkened_path |        | rm in the encrypted fs    |
| touch    | encrypted_fs, darkened_path |        | touch in the encrypted fs |

And theirs siblings `remotemv`  ,etc

## üßô How does it works?
Magic! (**soon explained**)

### How  is the fs encrypted ?
structure, retrieve content without key etc ...

### How does the remote interaction work  with the encrypted fs?
Here the sequence of a `remotecat`. 

Previously we have our `ubac` listener launch on an accesible port on remote and the encrypted fs in the same location as the listener:

 1. `-remotecat path/to/file <key>`
 2. The path is encrypted using the `darken_path`function ~~> `darkenedpath`
 3. The adret send a request to the ubac listener to perform a `cat` with `darkenedpath`
 4. The ubec listener perform the cat and return the encrypted result to `adret`
 5. `adret` decrypt it and print the result

